<!DOCTYPE html>
<html>
<head>
  <meta name=viewport content="initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="description" content="FoldApp Interface for Airbitz" />
  <meta charset=utf-8 />
  <title>FoldApp</title>
  <link rel="stylesheet" href="css/core.css">
</head>

<body>
  <div class="container-fluid">
  	<center>
	  	<h2 class="balance">Total Balance: <span class="balance-amt">$0.00</span></h1>
	  	<h3 class="add-funds">Add Funds</h3>

	  	<div class="row">
	  		<div class="col-md-12">
	  			<div class="card-barcode"></div>
	  		</div>
	  	</div>

	  	<div class="row">
	  		<div class="col-md-12">
		  		<button type="button" class="btn btn-info btn-lg btn-add">$5</button> <!-- First button -->
		  		<button type="button" class="btn btn-info btn-lg btn-add add-second">$10</button> <!-- Second button -->
		  	</div>
		</div>

		<!-- Thrid button -->
		<div class="row">
			<div class="col-md-12">
		  		<button type="button" class="btn btn-info btn-lg btn-add add-third">$25</button>
		  	</div>
		</div>

		<h4 class="dashboard-bottom-buttons">Powered by <a href="https://foldapp.com">FoldApp</a></div>

  	</center>
  </div>

  <script src="js/abc.js" type="text/javascript"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript">
  fold_api = "https://api.foldapp.com/v1/";

  function sRequest(url, json, handleReponse) {
  	$.ajax({
	    headers: {
	        'Accept' : 'application/json',
	        'Content-Type' : 'application/json'
	    },
	    'type' : 'POST',
	    'url' : url,
	    'data' : JSON.stringify(json),
	    'dataType': 'json',
	    success : function(response) {
	    	handleReponse(response);
	    }
	}).fail(function(xhr, textStatus, error) {
		console.log("There was an error. Status: " + xhr.status);
		console.log(xhr.Message);
	});
  }

  var Account = {
  	exists: $.Deferred(),
  	logged_in: $.Deferred(),
  	create: function() {
  		url = fold_api + "users";
	  	newAcc = {"users": [{
	  	  "random_username": true,
	  	  "random_password": true
	  	}]}
		sRequest(url, newAcc, function(r) {
			console.log(r);
			Account.creds = {"users": [{
			  "username": r['users'][0]['username'],
			  "password": r['users'][0]['password']
			}]};
			Account.exists.resolve();
		});
  	},
  	login: function() {
  		url = fold_api + "my/session";
  		console.log(Account.creds);
  		sRequest(url, Account.creds, function(r) { 
  			console.log(r);
  			Account.logged_in.resolve(r);
  		});
  	},
  	getProfile: function(handleReponse) {
  		$.get( (fold_api + "my/profile") ).done(function(response) {
  			handleReponse(response);
  		});
  	},
  	getBrands: function(handleReponse) {
  		url = fold_api + "brands"
  		$.get(url).done(function(response) {
  			handleReponse(response);
  		});
  	},
  	purchaseSb: function(amt) {
  		newOrder = { "orders": [{
		    "brand_id": "Starbucks",
		    "value": { "amount": amt, "currency": "USD" },
		    "price": { "currency": "BTC" }
		  }],
		  "cancel_all_others": true
		}
  		url = fold_api + "my/orders";
  		console.log("Getting new order");
  		sRequest(url, newOrder, function(r) {
  			Airbitz.ui.showAlert("", "Order" + JSON.stringify(r), "");
			console.log("Order: " + JSON.stringify(r));
  		});
  	}
  }
  // Main
  var user = Object.create(Account);
  existingAcc = false;

  if(!existingAcc) {
  	user.create();
  } else {
  	user.exists.resolve();
  }
  $.when(user.exists).done(function(data) {
  	user.login();
  });
  $.when(user.logged_in).done(function(data) {
  	user.getProfile(function(response) {
  		console.log(response["logged_in"]);
  		user.purchaseSb(5);
  	});
  });
  </script>
</body>
</html>










